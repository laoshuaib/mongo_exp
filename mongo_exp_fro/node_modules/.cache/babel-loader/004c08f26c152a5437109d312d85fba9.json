{"ast":null,"code":"import { inject, ref, computed, onMounted, watch, toRef, onUnmounted } from 'vue';\nimport '../../tokens/index.mjs';\nimport { useId } from '../use-id/index.mjs';\nimport { formContextKey, formItemContextKey } from '../../tokens/form.mjs';\n\nconst useFormItem = () => {\n  const form = inject(formContextKey, void 0);\n  const formItem = inject(formItemContextKey, void 0);\n  return {\n    form,\n    formItem\n  };\n};\n\nconst useFormItemInputId = (props, {\n  formItemContext,\n  disableIdGeneration,\n  disableIdManagement\n}) => {\n  if (!disableIdGeneration) {\n    disableIdGeneration = ref(false);\n  }\n\n  if (!disableIdManagement) {\n    disableIdManagement = ref(false);\n  }\n\n  const inputId = ref();\n  let idUnwatch = void 0;\n  const isLabeledByFormItem = computed(() => {\n    var _a;\n\n    return !!(!props.label && formItemContext && formItemContext.inputIds && ((_a = formItemContext.inputIds) == null ? void 0 : _a.length) <= 1);\n  });\n  onMounted(() => {\n    idUnwatch = watch([toRef(props, \"id\"), disableIdGeneration], ([id, disableIdGeneration2]) => {\n      const newId = id != null ? id : !disableIdGeneration2 ? useId().value : void 0;\n\n      if (newId !== inputId.value) {\n        if (formItemContext == null ? void 0 : formItemContext.removeInputId) {\n          inputId.value && formItemContext.removeInputId(inputId.value);\n\n          if (!(disableIdManagement == null ? void 0 : disableIdManagement.value) && !disableIdGeneration2 && newId) {\n            formItemContext.addInputId(newId);\n          }\n        }\n\n        inputId.value = newId;\n      }\n    }, {\n      immediate: true\n    });\n  });\n  onUnmounted(() => {\n    idUnwatch && idUnwatch();\n\n    if (formItemContext == null ? void 0 : formItemContext.removeInputId) {\n      inputId.value && formItemContext.removeInputId(inputId.value);\n    }\n  });\n  return {\n    isLabeledByFormItem,\n    inputId\n  };\n};\n\nexport { useFormItem, useFormItemInputId };","map":{"version":3,"mappings":";;;;;AAWY,MAACA,WAAW,GAAG,MAAM;EAC/B,MAAMC,IAAI,GAAGC,MAAM,CAACC,cAAD,EAAiB,KAAK,CAAtB,CAAnB;EACA,MAAMC,QAAQ,GAAGF,MAAM,CAACG,kBAAD,EAAqB,KAAK,CAA1B,CAAvB;EACA,OAAO;IACLJ,IADK;IAELG;EAFK,CAAP;AAIF,CAPY;;AAQA,MAACE,kBAAkB,GAAG,CAACC,KAAD,EAAQ;EACxCC,eADwC;EAExCC,mBAFwC;EAGxCC;AAHwC,CAAR,KAI5B;EACJ,IAAI,CAACD,mBAAL,EAA0B;IACxBA,mBAAmB,GAAGE,GAAG,CAAC,KAAD,CAAzB;EACD;;EACD,IAAI,CAACD,mBAAL,EAA0B;IACxBA,mBAAmB,GAAGC,GAAG,CAAC,KAAD,CAAzB;EACD;;EACD,MAAMC,OAAO,GAAGD,GAAG,EAAnB;EACA,IAAIE,SAAS,GAAG,KAAK,CAArB;EACA,MAAMC,mBAAmB,GAAGC,QAAQ,CAAC,MAAM;IACzC,IAAIC,EAAJ;;IACA,OAAO,CAAC,EAAE,CAACT,KAAK,CAACU,KAAP,IAAgBT,eAAhB,IAAmCA,eAAe,CAACU,QAAnD,IAA+D,CAAC,CAACF,EAAE,GAAGR,eAAe,CAACU,QAAtB,KAAmC,IAAnC,GAA0C,KAAK,CAA/C,GAAmDF,EAAE,CAACG,MAAvD,KAAkE,CAAnI,CAAR;EACD,CAHmC,CAApC;EAIAC,SAAS,CAAC,MAAM;IACdP,SAAS,GAAGQ,KAAK,CAAC,CAACC,KAAK,CAACf,KAAD,EAAQ,IAAR,CAAN,EAAqBE,mBAArB,CAAD,EAA4C,CAAC,CAACc,EAAD,EAAKC,oBAAL,CAAD,KAAgC;MAC3F,MAAMC,KAAK,GAAGF,EAAE,IAAI,IAAN,GAAaA,EAAb,GAAkB,CAACC,oBAAD,GAAwBE,KAAK,GAAGC,KAAhC,GAAwC,KAAK,CAA7E;;MACA,IAAIF,KAAK,KAAKb,OAAO,CAACe,KAAtB,EAA6B;QAC3B,IAAInB,eAAe,IAAI,IAAnB,GAA0B,KAAK,CAA/B,GAAmCA,eAAe,CAACoB,aAAvD,EAAsE;UACpEhB,OAAO,CAACe,KAAR,IAAiBnB,eAAe,CAACoB,aAAhB,CAA8BhB,OAAO,CAACe,KAAtC,CAAjB;;UACA,IAAI,EAAEjB,mBAAmB,IAAI,IAAvB,GAA8B,KAAK,CAAnC,GAAuCA,mBAAmB,CAACiB,KAA7D,KAAuE,CAACH,oBAAxE,IAAgGC,KAApG,EAA2G;YACzGjB,eAAe,CAACqB,UAAhB,CAA2BJ,KAA3B;UACD;QACF;;QACDb,OAAO,CAACe,KAAR,GAAgBF,KAAhB;MACD;IACF,CAXgB,EAWd;MAAEK,SAAS,EAAE;IAAb,CAXc,CAAjB;EAYD,CAbQ,CAAT;EAcAC,WAAW,CAAC,MAAM;IAChBlB,SAAS,IAAIA,SAAS,EAAtB;;IACA,IAAIL,eAAe,IAAI,IAAnB,GAA0B,KAAK,CAA/B,GAAmCA,eAAe,CAACoB,aAAvD,EAAsE;MACpEhB,OAAO,CAACe,KAAR,IAAiBnB,eAAe,CAACoB,aAAhB,CAA8BhB,OAAO,CAACe,KAAtC,CAAjB;IACD;EACF,CALU,CAAX;EAMA,OAAO;IACLb,mBADK;IAELF;EAFK,CAAP;AAIF,CAzCY","names":["useFormItem","form","inject","formContextKey","formItem","formItemContextKey","useFormItemInputId","props","formItemContext","disableIdGeneration","disableIdManagement","ref","inputId","idUnwatch","isLabeledByFormItem","computed","_a","label","inputIds","length","onMounted","watch","toRef","id","disableIdGeneration2","newId","useId","value","removeInputId","addInputId","immediate","onUnmounted"],"sources":["../../../../../packages/hooks/use-form-item/index.ts"],"sourcesContent":["import {\n  computed,\n  inject,\n  onMounted,\n  onUnmounted,\n  ref,\n  toRef,\n  watch,\n} from 'vue'\nimport { formContextKey, formItemContextKey } from '@element-plus/tokens'\nimport { useId } from '../use-id'\nimport type { FormItemContext } from '@element-plus/tokens'\nimport type { ComputedRef, Ref, WatchStopHandle } from 'vue'\n\nexport const useFormItem = () => {\n  const form = inject(formContextKey, undefined)\n  const formItem = inject(formItemContextKey, undefined)\n  return {\n    form,\n    formItem,\n  }\n}\n\nexport type IUseFormItemInputCommonProps = {\n  id?: string\n  label?: string | number | boolean | Record<string, any>\n}\n\nexport const useFormItemInputId = (\n  props: Partial<IUseFormItemInputCommonProps>,\n  {\n    formItemContext,\n    disableIdGeneration,\n    disableIdManagement,\n  }: {\n    formItemContext?: FormItemContext\n    disableIdGeneration?: ComputedRef<boolean> | Ref<boolean>\n    disableIdManagement?: ComputedRef<boolean> | Ref<boolean>\n  }\n) => {\n  if (!disableIdGeneration) {\n    disableIdGeneration = ref<boolean>(false)\n  }\n  if (!disableIdManagement) {\n    disableIdManagement = ref<boolean>(false)\n  }\n\n  const inputId = ref<string>()\n  let idUnwatch: WatchStopHandle | undefined = undefined\n\n  const isLabeledByFormItem = computed<boolean>(() => {\n    return !!(\n      !props.label &&\n      formItemContext &&\n      formItemContext.inputIds &&\n      formItemContext.inputIds?.length <= 1\n    )\n  })\n\n  // Generate id for ElFormItem label if not provided as prop\n  onMounted(() => {\n    idUnwatch = watch(\n      [toRef(props, 'id'), disableIdGeneration] as any,\n      ([id, disableIdGeneration]: [string, boolean]) => {\n        const newId = id ?? (!disableIdGeneration ? useId().value : undefined)\n        if (newId !== inputId.value) {\n          if (formItemContext?.removeInputId) {\n            inputId.value && formItemContext.removeInputId(inputId.value)\n            if (!disableIdManagement?.value && !disableIdGeneration && newId) {\n              formItemContext.addInputId(newId)\n            }\n          }\n          inputId.value = newId\n        }\n      },\n      { immediate: true }\n    )\n  })\n\n  onUnmounted(() => {\n    idUnwatch && idUnwatch()\n    if (formItemContext?.removeInputId) {\n      inputId.value && formItemContext.removeInputId(inputId.value)\n    }\n  })\n\n  return {\n    isLabeledByFormItem,\n    inputId,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}