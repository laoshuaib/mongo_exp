{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport { inject, computed, ref } from 'vue';\nimport '../../../utils/index.mjs';\nimport '../../../constants/index.mjs';\nimport '../../../hooks/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { generateId } from '../../../utils/rand.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { addClass } from '../../../utils/dom/style.mjs';\n\nconst useDropdown = () => {\n  const elDropdown = inject(\"elDropdown\", {});\n\n  const _elDropdownSize = computed(() => elDropdown == null ? void 0 : elDropdown.dropdownSize);\n\n  return {\n    elDropdown,\n    _elDropdownSize\n  };\n};\n\nconst initDropdownDomEvent = (dropdownChildren, triggerElm, _instance) => {\n  const ns = useNamespace(\"dropdown\");\n  const menuItems = ref(null);\n  const menuItemsArray = ref(null);\n  const dropdownElm = ref(null);\n  const listId = ref(`dropdown-menu-${generateId()}`);\n  dropdownElm.value = dropdownChildren == null ? void 0 : dropdownChildren.subTree.el;\n\n  function removeTabindex() {\n    var _a;\n\n    triggerElm.setAttribute(\"tabindex\", \"-1\");\n    (_a = menuItemsArray.value) == null ? void 0 : _a.forEach(item => {\n      item.setAttribute(\"tabindex\", \"-1\");\n    });\n  }\n\n  function resetTabindex(ele) {\n    removeTabindex();\n    ele == null ? void 0 : ele.setAttribute(\"tabindex\", \"0\");\n  }\n\n  function handleTriggerKeyDown(ev) {\n    const code = ev.code;\n\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      removeTabindex();\n      resetTabindex(menuItems.value[0]);\n      menuItems.value[0].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === EVENT_CODE.enter) {\n      _instance.handleClick();\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n    }\n  }\n\n  function handleItemKeyDown(ev) {\n    const code = ev.code;\n    const target = ev.target;\n    const currentIndex = menuItemsArray.value.indexOf(target);\n    const max = menuItemsArray.value.length - 1;\n    let nextIndex;\n\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      if (code === EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0;\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max;\n      }\n\n      removeTabindex();\n      resetTabindex(menuItems.value[nextIndex]);\n      menuItems.value[nextIndex].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === EVENT_CODE.enter) {\n      triggerElmFocus();\n      target.click();\n\n      if (_instance.props.hideOnClick) {\n        _instance.hide();\n      }\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n\n      triggerElmFocus();\n    }\n  }\n\n  function initAria() {\n    dropdownElm.value.setAttribute(\"id\", listId.value);\n    triggerElm.setAttribute(\"aria-haspopup\", \"list\");\n    triggerElm.setAttribute(\"aria-controls\", listId.value);\n\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute(\"role\", \"button\");\n      triggerElm.setAttribute(\"tabindex\", _instance.props.tabindex);\n      addClass(triggerElm, ns.b(\"selfdefine\"));\n    }\n  }\n\n  function initEvent() {\n    var _a;\n\n    triggerElm == null ? void 0 : triggerElm.addEventListener(\"keydown\", handleTriggerKeyDown);\n    (_a = dropdownElm.value) == null ? void 0 : _a.addEventListener(\"keydown\", handleItemKeyDown, true);\n  }\n\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\"[tabindex='-1']\");\n    menuItemsArray.value = Array.from(menuItems.value);\n    initEvent();\n    initAria();\n  }\n\n  function triggerElmFocus() {\n    triggerElm.focus();\n  }\n\n  initDomOperation();\n};\n\nexport { initDropdownDomEvent, useDropdown };","map":{"version":3,"mappings":";;;;;;;;;;AAIY,MAACA,WAAW,GAAG,MAAM;EAC/B,MAAMC,UAAU,GAAGC,MAAM,CAAC,YAAD,EAAe,EAAf,CAAzB;;EACA,MAAMC,eAAe,GAAGC,QAAQ,CAAC,MAAMH,UAAU,IAAI,IAAd,GAAqB,KAAK,CAA1B,GAA8BA,UAAU,CAACI,YAAhD,CAAhC;;EACA,OAAO;IACLJ,UADK;IAELE;EAFK,CAAP;AAIF,CAPY;;AAQA,MAACG,oBAAoB,GAAG,CAACC,gBAAD,EAAmBC,UAAnB,EAA+BC,SAA/B,KAA6C;EAC/E,MAAMC,EAAE,GAAGC,YAAY,CAAC,UAAD,CAAvB;EACA,MAAMC,SAAS,GAAGC,GAAG,CAAC,IAAD,CAArB;EACA,MAAMC,cAAc,GAAGD,GAAG,CAAC,IAAD,CAA1B;EACA,MAAME,WAAW,GAAGF,GAAG,CAAC,IAAD,CAAvB;EACA,MAAMG,MAAM,GAAGH,GAAG,CAAE,iBAAgBI,UAAU,EAAG,EAA/B,CAAlB;EACAF,WAAW,CAACG,KAAZ,GAAoBX,gBAAgB,IAAI,IAApB,GAA2B,KAAK,CAAhC,GAAoCA,gBAAgB,CAACY,OAAjB,CAAyBC,EAAjF;;EACA,SAASC,cAAT,GAA0B;IACxB,IAAIC,EAAJ;;IACAd,UAAU,CAACe,YAAX,CAAwB,UAAxB,EAAoC,IAApC;IACA,CAACD,EAAE,GAAGR,cAAc,CAACI,KAArB,KAA+B,IAA/B,GAAsC,KAAK,CAA3C,GAA+CI,EAAE,CAACE,OAAH,CAAYC,IAAD,IAAU;MAClEA,IAAI,CAACF,YAAL,CAAkB,UAAlB,EAA8B,IAA9B;IACD,CAF8C,CAA/C;EAGD;;EACD,SAASG,aAAT,CAAuBC,GAAvB,EAA4B;IAC1BN,cAAc;IACdM,GAAG,IAAI,IAAP,GAAc,KAAK,CAAnB,GAAuBA,GAAG,CAACJ,YAAJ,CAAiB,UAAjB,EAA6B,GAA7B,CAAvB;EACD;;EACD,SAASK,oBAAT,CAA8BC,EAA9B,EAAkC;IAChC,MAAMC,IAAI,GAAGD,EAAE,CAACC,IAAhB;;IACA,IAAI,CAACC,UAAU,CAACC,EAAZ,EAAgBD,UAAU,CAACE,IAA3B,EAAiCC,QAAjC,CAA0CJ,IAA1C,CAAJ,EAAqD;MACnDT,cAAc;MACdK,aAAa,CAACd,SAAS,CAACM,KAAV,CAAgB,CAAhB,CAAD,CAAb;MACAN,SAAS,CAACM,KAAV,CAAgB,CAAhB,EAAmBiB,KAAnB;MACAN,EAAE,CAACO,cAAH;MACAP,EAAE,CAACQ,eAAH;IACD,CAND,MAMO,IAAIP,IAAI,KAAKC,UAAU,CAACO,KAAxB,EAA+B;MACpC7B,SAAS,CAAC8B,WAAV;IACD,CAFM,MAEA,IAAI,CAACR,UAAU,CAACS,GAAZ,EAAiBT,UAAU,CAACU,GAA5B,EAAiCP,QAAjC,CAA0CJ,IAA1C,CAAJ,EAAqD;MAC1DrB,SAAS,CAACiC,IAAV;IACD;EACF;;EACD,SAASC,iBAAT,CAA2Bd,EAA3B,EAA+B;IAC7B,MAAMC,IAAI,GAAGD,EAAE,CAACC,IAAhB;IACA,MAAMc,MAAM,GAAGf,EAAE,CAACe,MAAlB;IACA,MAAMC,YAAY,GAAG/B,cAAc,CAACI,KAAf,CAAqB4B,OAArB,CAA6BF,MAA7B,CAArB;IACA,MAAMG,GAAG,GAAGjC,cAAc,CAACI,KAAf,CAAqB8B,MAArB,GAA8B,CAA1C;IACA,IAAIC,SAAJ;;IACA,IAAI,CAAClB,UAAU,CAACC,EAAZ,EAAgBD,UAAU,CAACE,IAA3B,EAAiCC,QAAjC,CAA0CJ,IAA1C,CAAJ,EAAqD;MACnD,IAAIA,IAAI,KAAKC,UAAU,CAACC,EAAxB,EAA4B;QAC1BiB,SAAS,GAAGJ,YAAY,KAAK,CAAjB,GAAqBA,YAAY,GAAG,CAApC,GAAwC,CAApD;MACD,CAFD,MAEO;QACLI,SAAS,GAAGJ,YAAY,GAAGE,GAAf,GAAqBF,YAAY,GAAG,CAApC,GAAwCE,GAApD;MACD;;MACD1B,cAAc;MACdK,aAAa,CAACd,SAAS,CAACM,KAAV,CAAgB+B,SAAhB,CAAD,CAAb;MACArC,SAAS,CAACM,KAAV,CAAgB+B,SAAhB,EAA2Bd,KAA3B;MACAN,EAAE,CAACO,cAAH;MACAP,EAAE,CAACQ,eAAH;IACD,CAXD,MAWO,IAAIP,IAAI,KAAKC,UAAU,CAACO,KAAxB,EAA+B;MACpCY,eAAe;MACfN,MAAM,CAACO,KAAP;;MACA,IAAI1C,SAAS,CAAC2C,KAAV,CAAgBC,WAApB,EAAiC;QAC/B5C,SAAS,CAACiC,IAAV;MACD;IACF,CANM,MAMA,IAAI,CAACX,UAAU,CAACS,GAAZ,EAAiBT,UAAU,CAACU,GAA5B,EAAiCP,QAAjC,CAA0CJ,IAA1C,CAAJ,EAAqD;MAC1DrB,SAAS,CAACiC,IAAV;;MACAQ,eAAe;IAChB;EACF;;EACD,SAASI,QAAT,GAAoB;IAClBvC,WAAW,CAACG,KAAZ,CAAkBK,YAAlB,CAA+B,IAA/B,EAAqCP,MAAM,CAACE,KAA5C;IACAV,UAAU,CAACe,YAAX,CAAwB,eAAxB,EAAyC,MAAzC;IACAf,UAAU,CAACe,YAAX,CAAwB,eAAxB,EAAyCP,MAAM,CAACE,KAAhD;;IACA,IAAI,CAACT,SAAS,CAAC2C,KAAV,CAAgBG,WAArB,EAAkC;MAChC/C,UAAU,CAACe,YAAX,CAAwB,MAAxB,EAAgC,QAAhC;MACAf,UAAU,CAACe,YAAX,CAAwB,UAAxB,EAAoCd,SAAS,CAAC2C,KAAV,CAAgBI,QAApD;MACAC,QAAQ,CAACjD,UAAD,EAAaE,EAAE,CAACgD,CAAH,CAAK,YAAL,CAAb,CAAR;IACD;EACF;;EACD,SAASC,SAAT,GAAqB;IACnB,IAAIrC,EAAJ;;IACAd,UAAU,IAAI,IAAd,GAAqB,KAAK,CAA1B,GAA8BA,UAAU,CAACoD,gBAAX,CAA4B,SAA5B,EAAuChC,oBAAvC,CAA9B;IACA,CAACN,EAAE,GAAGP,WAAW,CAACG,KAAlB,KAA4B,IAA5B,GAAmC,KAAK,CAAxC,GAA4CI,EAAE,CAACsC,gBAAH,CAAoB,SAApB,EAA+BjB,iBAA/B,EAAkD,IAAlD,CAA5C;EACD;;EACD,SAASkB,gBAAT,GAA4B;IAC1BjD,SAAS,CAACM,KAAV,GAAkBH,WAAW,CAACG,KAAZ,CAAkB4C,gBAAlB,CAAmC,iBAAnC,CAAlB;IACAhD,cAAc,CAACI,KAAf,GAAuB6C,KAAK,CAACC,IAAN,CAAWpD,SAAS,CAACM,KAArB,CAAvB;IACAyC,SAAS;IACTL,QAAQ;EACT;;EACD,SAASJ,eAAT,GAA2B;IACzB1C,UAAU,CAAC2B,KAAX;EACD;;EACD0B,gBAAgB;AAClB,CArFY","names":["useDropdown","elDropdown","inject","_elDropdownSize","computed","dropdownSize","initDropdownDomEvent","dropdownChildren","triggerElm","_instance","ns","useNamespace","menuItems","ref","menuItemsArray","dropdownElm","listId","generateId","value","subTree","el","removeTabindex","_a","setAttribute","forEach","item","resetTabindex","ele","handleTriggerKeyDown","ev","code","EVENT_CODE","up","down","includes","focus","preventDefault","stopPropagation","enter","handleClick","tab","esc","hide","handleItemKeyDown","target","currentIndex","indexOf","max","length","nextIndex","triggerElmFocus","click","props","hideOnClick","initAria","splitButton","tabindex","addClass","b","initEvent","addEventListener","initDomOperation","querySelectorAll","Array","from"],"sources":["../../../../../../packages/components/dropdown/src/useDropdown.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, inject, ref } from 'vue'\nimport { addClass, generateId } from '@element-plus/utils'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useNamespace } from '@element-plus/hooks'\nimport type { Nullable } from '@element-plus/utils'\nimport type { IElDropdownInstance } from './dropdown'\n\nexport const useDropdown = () => {\n  const elDropdown = inject<IElDropdownInstance>('elDropdown', {})\n  const _elDropdownSize = computed(() => elDropdown?.dropdownSize)\n\n  return {\n    elDropdown,\n    _elDropdownSize,\n  }\n}\n\nexport const initDropdownDomEvent = (\n  dropdownChildren,\n  triggerElm,\n  _instance\n) => {\n  const ns = useNamespace('dropdown')\n  const menuItems = ref<Nullable<HTMLButtonElement[]>>(null)\n  const menuItemsArray = ref<Nullable<HTMLElement[]>>(null)\n  const dropdownElm = ref<Nullable<HTMLElement>>(null)\n  const listId = ref(`dropdown-menu-${generateId()}`)\n  dropdownElm.value = dropdownChildren?.subTree.el\n\n  function removeTabindex() {\n    triggerElm.setAttribute('tabindex', '-1')\n    menuItemsArray.value?.forEach((item) => {\n      item.setAttribute('tabindex', '-1')\n    })\n  }\n\n  function resetTabindex(ele) {\n    removeTabindex()\n    ele?.setAttribute('tabindex', '0')\n  }\n\n  function handleTriggerKeyDown(ev: KeyboardEvent) {\n    const code = ev.code\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      removeTabindex()\n      resetTabindex(menuItems.value[0])\n      menuItems.value[0].focus()\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else if (code === EVENT_CODE.enter) {\n      _instance.handleClick()\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide()\n    }\n  }\n\n  function handleItemKeyDown(ev) {\n    const code = ev.code\n    const target = ev.target\n    const currentIndex = menuItemsArray.value.indexOf(target)\n    const max = menuItemsArray.value.length - 1\n    let nextIndex\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      if (code === EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max\n      }\n      removeTabindex()\n      resetTabindex(menuItems.value[nextIndex])\n      menuItems.value[nextIndex].focus()\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else if (code === EVENT_CODE.enter) {\n      triggerElmFocus()\n      target.click()\n      if (_instance.props.hideOnClick) {\n        _instance.hide()\n      }\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide()\n      triggerElmFocus()\n    }\n  }\n\n  function initAria() {\n    dropdownElm.value.setAttribute('id', listId.value)\n    triggerElm.setAttribute('aria-haspopup', 'list')\n    triggerElm.setAttribute('aria-controls', listId.value)\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute('role', 'button')\n      triggerElm.setAttribute('tabindex', _instance.props.tabindex)\n      addClass(triggerElm, ns.b('selfdefine'))\n    }\n  }\n\n  function initEvent() {\n    triggerElm?.addEventListener('keydown', handleTriggerKeyDown)\n    dropdownElm.value?.addEventListener('keydown', handleItemKeyDown, true)\n  }\n\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\n      \"[tabindex='-1']\"\n    ) as unknown as HTMLButtonElement[]\n    menuItemsArray.value = Array.from(menuItems.value)\n\n    initEvent()\n    initAria()\n  }\n\n  function triggerElmFocus() {\n    triggerElm.focus()\n  }\n\n  initDomOperation()\n}\n"]},"metadata":{},"sourceType":"module"}