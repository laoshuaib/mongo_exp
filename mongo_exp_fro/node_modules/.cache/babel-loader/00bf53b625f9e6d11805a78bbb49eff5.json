{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport { defineComponent, ref, computed, unref, watch, nextTick, openBlock, createElementBlock, normalizeClass, createElementVNode, toDisplayString, createCommentVNode, Fragment, renderList, createVNode } from 'vue';\nimport dayjs from 'dayjs';\nimport '../../../../hooks/index.mjs';\nimport '../../../../utils/index.mjs';\nimport { basicDateTableProps } from '../props/basic-date-table.mjs';\nimport { buildPickerTable } from '../utils.mjs';\nimport ElDatePickerCell from './basic-cell-render.mjs';\nimport _export_sfc from '../../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { useLocale } from '../../../../hooks/use-locale/index.mjs';\nimport { castArray } from '../../../../utils/arrays.mjs';\nconst _hoisted_1 = [\"aria-label\"];\nconst _hoisted_2 = {\n  key: 0,\n  scope: \"col\"\n};\nconst _hoisted_3 = [\"aria-label\"];\nconst _hoisted_4 = [\"aria-current\", \"aria-selected\", \"tabindex\"];\n\nconst _sfc_main = /* @__PURE__ */defineComponent({\n  __name: \"basic-date-table\",\n  props: basicDateTableProps,\n  emits: [\"changerange\", \"pick\", \"select\"],\n\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n    const ns = useNamespace(\"date-table\");\n    const {\n      t,\n      lang\n    } = useLocale();\n    const tbodyRef = ref();\n    const currentCellRef = ref();\n    const lastRow = ref();\n    const lastColumn = ref();\n    const tableRows = ref([[], [], [], [], [], []]);\n    let focusWithClick = false;\n    const firstDayOfWeek = props.date.$locale().weekStart || 7;\n    const WEEKS_CONSTANT = props.date.locale(\"en\").localeData().weekdaysShort().map(_ => _.toLowerCase());\n    const offsetDay = computed(() => {\n      return firstDayOfWeek > 3 ? 7 - firstDayOfWeek : -firstDayOfWeek;\n    });\n    const startDate = computed(() => {\n      const startDayOfMonth = props.date.startOf(\"month\");\n      return startDayOfMonth.subtract(startDayOfMonth.day() || 7, \"day\");\n    });\n    const WEEKS = computed(() => {\n      return WEEKS_CONSTANT.concat(WEEKS_CONSTANT).slice(firstDayOfWeek, firstDayOfWeek + 7);\n    });\n    const hasCurrent = computed(() => {\n      return rows.value.flat().some(row => {\n        return row.isCurrent;\n      });\n    });\n    const days = computed(() => {\n      const startOfMonth = props.date.startOf(\"month\");\n      const startOfMonthDay = startOfMonth.day() || 7;\n      const dateCountOfMonth = startOfMonth.daysInMonth();\n      const dateCountOfLastMonth = startOfMonth.subtract(1, \"month\").daysInMonth();\n      return {\n        startOfMonthDay,\n        dateCountOfMonth,\n        dateCountOfLastMonth\n      };\n    });\n    const selectedDate = computed(() => {\n      return props.selectionMode === \"dates\" ? castArray(props.parsedValue) : [];\n    });\n\n    const setDateText = (cell, {\n      count,\n      rowIndex,\n      columnIndex\n    }) => {\n      const {\n        startOfMonthDay,\n        dateCountOfMonth,\n        dateCountOfLastMonth\n      } = unref(days);\n      const offset = unref(offsetDay);\n\n      if (rowIndex >= 0 && rowIndex <= 1) {\n        const numberOfDaysFromPreviousMonth = startOfMonthDay + offset < 0 ? 7 + startOfMonthDay + offset : startOfMonthDay + offset;\n\n        if (columnIndex + rowIndex * 7 >= numberOfDaysFromPreviousMonth) {\n          cell.text = count;\n          return true;\n        } else {\n          cell.text = dateCountOfLastMonth - (numberOfDaysFromPreviousMonth - columnIndex % 7) + 1 + rowIndex * 7;\n          cell.type = \"prev-month\";\n        }\n      } else {\n        if (count <= dateCountOfMonth) {\n          cell.text = count;\n        } else {\n          cell.text = count - dateCountOfMonth;\n          cell.type = \"next-month\";\n        }\n\n        return true;\n      }\n\n      return false;\n    };\n\n    const setCellMetadata = (cell, {\n      columnIndex,\n      rowIndex\n    }, count) => {\n      const {\n        disabledDate,\n        cellClassName\n      } = props;\n\n      const _selectedDate = unref(selectedDate);\n\n      const shouldIncrement = setDateText(cell, {\n        count,\n        rowIndex,\n        columnIndex\n      });\n      const cellDate = cell.dayjs.toDate();\n      cell.selected = _selectedDate.find(d => d.valueOf() === cell.dayjs.valueOf());\n      cell.isSelected = !!cell.selected;\n      cell.isCurrent = isCurrent(cell);\n      cell.disabled = disabledDate == null ? void 0 : disabledDate(cellDate);\n      cell.customClass = cellClassName == null ? void 0 : cellClassName(cellDate);\n      return shouldIncrement;\n    };\n\n    const setRowMetadata = row => {\n      if (props.selectionMode === \"week\") {\n        const [start, end] = props.showWeekNumber ? [1, 7] : [0, 6];\n        const isActive = isWeekActive(row[start + 1]);\n        row[start].inRange = isActive;\n        row[start].start = isActive;\n        row[end].inRange = isActive;\n        row[end].end = isActive;\n      }\n    };\n\n    const rows = computed(() => {\n      const {\n        minDate,\n        maxDate,\n        rangeState,\n        showWeekNumber\n      } = props;\n      const offset = offsetDay.value;\n      const rows_ = tableRows.value;\n      const dateUnit = \"day\";\n      let count = 1;\n\n      if (showWeekNumber) {\n        for (let rowIndex = 0; rowIndex < 6; rowIndex++) {\n          if (!rows_[rowIndex][0]) {\n            rows_[rowIndex][0] = {\n              type: \"week\",\n              text: startDate.value.add(rowIndex * 7 + 1, dateUnit).week()\n            };\n          }\n        }\n      }\n\n      buildPickerTable({\n        row: 6,\n        column: 7\n      }, rows_, {\n        startDate: minDate,\n        columnIndexOffset: showWeekNumber ? 1 : 0,\n        nextEndDate: rangeState.endDate || maxDate || rangeState.selecting && minDate || null,\n        now: dayjs().locale(unref(lang)).startOf(dateUnit),\n        unit: dateUnit,\n        relativeDateGetter: idx => startDate.value.add(idx - offset, dateUnit),\n        setCellMetadata: (...args) => {\n          if (setCellMetadata(...args, count)) {\n            count += 1;\n          }\n        },\n        setRowMetadata\n      });\n      return rows_;\n    });\n    watch(() => props.date, async () => {\n      var _a, _b;\n\n      if ((_a = tbodyRef.value) == null ? void 0 : _a.contains(document.activeElement)) {\n        await nextTick();\n        (_b = currentCellRef.value) == null ? void 0 : _b.focus();\n      }\n    });\n\n    const focus = async () => {\n      var _a;\n\n      (_a = currentCellRef.value) == null ? void 0 : _a.focus();\n    };\n\n    const isNormalDay = (type = \"\") => {\n      return [\"normal\", \"today\"].includes(type);\n    };\n\n    const isCurrent = cell => {\n      return props.selectionMode === \"date\" && isNormalDay(cell.type) && cellMatchesDate(cell, props.parsedValue);\n    };\n\n    const cellMatchesDate = (cell, date) => {\n      if (!date) return false;\n      return dayjs(date).locale(lang.value).isSame(props.date.date(Number(cell.text)), \"day\");\n    };\n\n    const getCellClasses = cell => {\n      const classes = [];\n\n      if (isNormalDay(cell.type) && !cell.disabled) {\n        classes.push(\"available\");\n\n        if (cell.type === \"today\") {\n          classes.push(\"today\");\n        }\n      } else {\n        classes.push(cell.type);\n      }\n\n      if (isCurrent(cell)) {\n        classes.push(\"current\");\n      }\n\n      if (cell.inRange && (isNormalDay(cell.type) || props.selectionMode === \"week\")) {\n        classes.push(\"in-range\");\n\n        if (cell.start) {\n          classes.push(\"start-date\");\n        }\n\n        if (cell.end) {\n          classes.push(\"end-date\");\n        }\n      }\n\n      if (cell.disabled) {\n        classes.push(\"disabled\");\n      }\n\n      if (cell.selected) {\n        classes.push(\"selected\");\n      }\n\n      if (cell.customClass) {\n        classes.push(cell.customClass);\n      }\n\n      return classes.join(\" \");\n    };\n\n    const getDateOfCell = (row, column) => {\n      const offsetFromStart = row * 7 + (column - (props.showWeekNumber ? 1 : 0)) - offsetDay.value;\n      return startDate.value.add(offsetFromStart, \"day\");\n    };\n\n    const handleMouseMove = event => {\n      var _a;\n\n      if (!props.rangeState.selecting) return;\n      let target = event.target;\n\n      if (target.tagName === \"SPAN\") {\n        target = (_a = target.parentNode) == null ? void 0 : _a.parentNode;\n      }\n\n      if (target.tagName === \"DIV\") {\n        target = target.parentNode;\n      }\n\n      if (target.tagName !== \"TD\") return;\n      const row = target.parentNode.rowIndex - 1;\n      const column = target.cellIndex;\n      if (rows.value[row][column].disabled) return;\n\n      if (row !== lastRow.value || column !== lastColumn.value) {\n        lastRow.value = row;\n        lastColumn.value = column;\n        emit(\"changerange\", {\n          selecting: true,\n          endDate: getDateOfCell(row, column)\n        });\n      }\n    };\n\n    const isSelectedCell = cell => {\n      return !hasCurrent.value && (cell == null ? void 0 : cell.text) === 1 && cell.type === \"normal\" || cell.isCurrent;\n    };\n\n    const handleFocus = event => {\n      if (focusWithClick || hasCurrent.value || props.selectionMode !== \"date\") return;\n      handlePickDate(event, true);\n    };\n\n    const handleMouseDown = event => {\n      const target = event.target.closest(\"td\");\n      if (!target) return;\n      focusWithClick = true;\n    };\n\n    const handleMouseUp = event => {\n      const target = event.target.closest(\"td\");\n      if (!target) return;\n      focusWithClick = false;\n    };\n\n    const handlePickDate = (event, isKeyboardMovement = false) => {\n      const target = event.target.closest(\"td\");\n      if (!target) return;\n      const row = target.parentNode.rowIndex - 1;\n      const column = target.cellIndex;\n      const cell = rows.value[row][column];\n      if (cell.disabled || cell.type === \"week\") return;\n      const newDate = getDateOfCell(row, column);\n\n      if (props.selectionMode === \"range\") {\n        if (!props.rangeState.selecting || !props.minDate) {\n          emit(\"pick\", {\n            minDate: newDate,\n            maxDate: null\n          });\n          emit(\"select\", true);\n        } else {\n          if (newDate >= props.minDate) {\n            emit(\"pick\", {\n              minDate: props.minDate,\n              maxDate: newDate\n            });\n          } else {\n            emit(\"pick\", {\n              minDate: newDate,\n              maxDate: props.minDate\n            });\n          }\n\n          emit(\"select\", false);\n        }\n      } else if (props.selectionMode === \"date\") {\n        emit(\"pick\", newDate, isKeyboardMovement);\n      } else if (props.selectionMode === \"week\") {\n        const weekNumber = newDate.week();\n        const value = `${newDate.year()}w${weekNumber}`;\n        emit(\"pick\", {\n          year: newDate.year(),\n          week: weekNumber,\n          value,\n          date: newDate.startOf(\"week\")\n        });\n      } else if (props.selectionMode === \"dates\") {\n        const newValue = cell.selected ? castArray(props.parsedValue).filter(d => (d == null ? void 0 : d.valueOf()) !== newDate.valueOf()) : castArray(props.parsedValue).concat([newDate]);\n        emit(\"pick\", newValue);\n      }\n    };\n\n    const isWeekActive = cell => {\n      if (props.selectionMode !== \"week\") return false;\n      let newDate = props.date.startOf(\"day\");\n\n      if (cell.type === \"prev-month\") {\n        newDate = newDate.subtract(1, \"month\");\n      }\n\n      if (cell.type === \"next-month\") {\n        newDate = newDate.add(1, \"month\");\n      }\n\n      newDate = newDate.date(Number.parseInt(cell.text, 10));\n\n      if (props.parsedValue && !Array.isArray(props.parsedValue)) {\n        const dayOffset = (props.parsedValue.day() - firstDayOfWeek + 7) % 7 - 1;\n        const weekDate = props.parsedValue.subtract(dayOffset, \"day\");\n        return weekDate.isSame(newDate, \"day\");\n      }\n\n      return false;\n    };\n\n    expose({\n      focus\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"table\", {\n        role: \"grid\",\n        \"aria-label\": unref(t)(\"el.datepicker.dateTablePrompt\"),\n        cellspacing: \"0\",\n        cellpadding: \"0\",\n        class: normalizeClass([unref(ns).b(), {\n          \"is-week-mode\": _ctx.selectionMode === \"week\"\n        }]),\n        onClick: handlePickDate,\n        onMousemove: handleMouseMove,\n        onMousedown: handleMouseDown,\n        onMouseup: handleMouseUp\n      }, [createElementVNode(\"tbody\", {\n        ref_key: \"tbodyRef\",\n        ref: tbodyRef\n      }, [createElementVNode(\"tr\", null, [_ctx.showWeekNumber ? (openBlock(), createElementBlock(\"th\", _hoisted_2, toDisplayString(unref(t)(\"el.datepicker.week\")), 1)) : createCommentVNode(\"v-if\", true), (openBlock(true), createElementBlock(Fragment, null, renderList(unref(WEEKS), (week, key) => {\n        return openBlock(), createElementBlock(\"th\", {\n          key,\n          scope: \"col\",\n          \"aria-label\": unref(t)(\"el.datepicker.weeksFull.\" + week)\n        }, toDisplayString(unref(t)(\"el.datepicker.weeks.\" + week)), 9, _hoisted_3);\n      }), 128))]), (openBlock(true), createElementBlock(Fragment, null, renderList(unref(rows), (row, rowKey) => {\n        return openBlock(), createElementBlock(\"tr\", {\n          key: rowKey,\n          class: normalizeClass([unref(ns).e(\"row\"), {\n            current: isWeekActive(row[1])\n          }])\n        }, [(openBlock(true), createElementBlock(Fragment, null, renderList(row, (cell, columnKey) => {\n          return openBlock(), createElementBlock(\"td\", {\n            key: `${rowKey}.${columnKey}`,\n            ref_for: true,\n            ref: el => isSelectedCell(cell) && (currentCellRef.value = el),\n            class: normalizeClass(getCellClasses(cell)),\n            \"aria-current\": cell.isCurrent ? \"date\" : void 0,\n            \"aria-selected\": cell.isCurrent,\n            tabindex: isSelectedCell(cell) ? 0 : -1,\n            onFocus: handleFocus\n          }, [createVNode(unref(ElDatePickerCell), {\n            cell\n          }, null, 8, [\"cell\"])], 42, _hoisted_4);\n        }), 128))], 2);\n      }), 128))], 512)], 42, _hoisted_1);\n    };\n  }\n\n});\n\nvar DateTable = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/date-picker/src/date-picker-com/basic-date-table.vue\"]]);\n\nexport { DateTable as default };","map":{"version":3,"mappings":"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","names":["useNamespace","t","lang","useLocale","tbodyRef","ref","currentCellRef","lastRow","lastColumn","tableRows","focusWithClick","firstDayOfWeek","date","$locale","weekStart","WEEKS_CONSTANT","locale","localeData","weekdaysShort","map","_","toLowerCase","computed","startDayOfMonth","startOf","subtract","day","concat","slice","rows","value","flat","some","row","startOfMonth","daysInMonth","dateCountOfLastMonth","startOfMonthDay","dateCountOfMonth","props","selectionMode","castArray","cell","count","rowIndex","columnIndex","unref","days","offsetDay","numberOfDaysFromPreviousMonth","offset","text","type","disabledDate","cellClassName","selectedDate","shouldIncrement","setDateText","toDate","_selectedDate","d","dayjs","valueOf","isCurrent","start","end","isActive","inRange","minDate","maxDate","rangeState","showWeekNumber","rows_","dateUnit","startDate","add","week","buildPickerTable","column","columnIndexOffset","nextEndDate","selecting","now","unit","relativeDateGetter","idx","setCellMetadata","args","setRowMetadata","watch","_a","_b","includes","isNormalDay","cellMatchesDate","isSame","getCellClasses","classes","push","customClass","offsetFromStart","tagName","target","disabled","emit","endDate","handlePickDate","event","newDate","isKeyboardMovement","year","isWeekActive"],"sources":["../../../../../../../packages/components/date-picker/src/date-picker-com/basic-date-table.vue"],"sourcesContent":["<template>\n  <table\n    role=\"grid\"\n    :aria-label=\"t('el.datepicker.dateTablePrompt')\"\n    cellspacing=\"0\"\n    cellpadding=\"0\"\n    :class=\"[ns.b(), { 'is-week-mode': selectionMode === 'week' }]\"\n    @click=\"handlePickDate\"\n    @mousemove=\"handleMouseMove\"\n    @mousedown=\"handleMouseDown\"\n    @mouseup=\"handleMouseUp\"\n  >\n    <tbody ref=\"tbodyRef\">\n      <tr>\n        <th v-if=\"showWeekNumber\" scope=\"col\">{{ t('el.datepicker.week') }}</th>\n        <th\n          v-for=\"(week, key) in WEEKS\"\n          :key=\"key\"\n          scope=\"col\"\n          :aria-label=\"t('el.datepicker.weeksFull.' + week)\"\n        >\n          {{ t('el.datepicker.weeks.' + week) }}\n        </th>\n      </tr>\n      <tr\n        v-for=\"(row, rowKey) in rows\"\n        :key=\"rowKey\"\n        :class=\"[ns.e('row'), { current: isWeekActive(row[1]) }]\"\n      >\n        <td\n          v-for=\"(cell, columnKey) in row\"\n          :key=\"`${rowKey}.${columnKey}`\"\n          :ref=\"(el) => isSelectedCell(cell) && (currentCellRef = el as HTMLElement)\"\n          :class=\"getCellClasses(cell)\"\n          :aria-current=\"cell.isCurrent ? 'date' : undefined\"\n          :aria-selected=\"cell.isCurrent\"\n          :tabindex=\"isSelectedCell(cell) ? 0 : -1\"\n          @focus=\"handleFocus\"\n        >\n          <el-date-picker-cell :cell=\"cell\" />\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, nextTick, ref, unref, watch } from 'vue'\nimport dayjs from 'dayjs'\nimport { useLocale, useNamespace } from '@element-plus/hooks'\nimport { castArray } from '@element-plus/utils'\nimport { basicDateTableProps } from '../props/basic-date-table'\nimport { buildPickerTable } from '../utils'\nimport ElDatePickerCell from './basic-cell-render'\n\nimport type { Dayjs } from 'dayjs'\nimport type { DateCell } from '../date-picker.type'\n\nconst props = defineProps(basicDateTableProps)\nconst emit = defineEmits(['changerange', 'pick', 'select'])\n\nconst ns = useNamespace('date-table')\n\nconst { t, lang } = useLocale()\n\nconst tbodyRef = ref<HTMLElement>()\nconst currentCellRef = ref<HTMLElement>()\n// data\nconst lastRow = ref<number>()\nconst lastColumn = ref<number>()\nconst tableRows = ref<DateCell[][]>([[], [], [], [], [], []])\n\nlet focusWithClick = false\n\n// todo better way to get Day.js locale object\nconst firstDayOfWeek = (props.date as any).$locale().weekStart || 7\nconst WEEKS_CONSTANT = props.date\n  .locale('en')\n  .localeData()\n  .weekdaysShort()\n  .map((_) => _.toLowerCase())\n\nconst offsetDay = computed(() => {\n  // Sunday 7(0), cal the left and right offset days, 3217654, such as Monday is -1, the is to adjust the position of the first two rows of dates\n  return firstDayOfWeek > 3 ? 7 - firstDayOfWeek : -firstDayOfWeek\n})\n\nconst startDate = computed(() => {\n  const startDayOfMonth = props.date.startOf('month')\n  return startDayOfMonth.subtract(startDayOfMonth.day() || 7, 'day')\n})\n\nconst WEEKS = computed(() => {\n  return WEEKS_CONSTANT.concat(WEEKS_CONSTANT).slice(\n    firstDayOfWeek,\n    firstDayOfWeek + 7\n  )\n})\n\nconst hasCurrent = computed<boolean>(() => {\n  return rows.value.flat().some((row) => {\n    return row.isCurrent\n  })\n})\n\nconst days = computed(() => {\n  const startOfMonth = props.date.startOf('month')\n  const startOfMonthDay = startOfMonth.day() || 7 // day of first day\n  const dateCountOfMonth = startOfMonth.daysInMonth()\n\n  const dateCountOfLastMonth = startOfMonth.subtract(1, 'month').daysInMonth()\n\n  return {\n    startOfMonthDay,\n    dateCountOfMonth,\n    dateCountOfLastMonth,\n  }\n})\n\nconst selectedDate = computed(() => {\n  return props.selectionMode === 'dates'\n    ? (castArray(props.parsedValue) as Dayjs[])\n    : ([] as Dayjs[])\n})\n\n// Return value indicates should the counter be incremented\nconst setDateText = (\n  cell: DateCell,\n  {\n    count,\n    rowIndex,\n    columnIndex,\n  }: {\n    count: number\n    rowIndex: number\n    columnIndex: number\n  }\n): boolean => {\n  const { startOfMonthDay, dateCountOfMonth, dateCountOfLastMonth } =\n    unref(days)\n  const offset = unref(offsetDay)\n  if (rowIndex >= 0 && rowIndex <= 1) {\n    const numberOfDaysFromPreviousMonth =\n      startOfMonthDay + offset < 0\n        ? 7 + startOfMonthDay + offset\n        : startOfMonthDay + offset\n\n    if (columnIndex + rowIndex * 7 >= numberOfDaysFromPreviousMonth) {\n      cell.text = count\n      return true\n    } else {\n      cell.text =\n        dateCountOfLastMonth -\n        (numberOfDaysFromPreviousMonth - (columnIndex % 7)) +\n        1 +\n        rowIndex * 7\n      cell.type = 'prev-month'\n    }\n  } else {\n    if (count <= dateCountOfMonth) {\n      cell.text = count\n    } else {\n      cell.text = count - dateCountOfMonth\n      cell.type = 'next-month'\n    }\n    return true\n  }\n  return false\n}\n\nconst setCellMetadata = (\n  cell: DateCell,\n  {\n    columnIndex,\n    rowIndex,\n  }: {\n    columnIndex: number\n    rowIndex: number\n  },\n  count: number\n) => {\n  const { disabledDate, cellClassName } = props\n  const _selectedDate = unref(selectedDate)\n  const shouldIncrement = setDateText(cell, { count, rowIndex, columnIndex })\n\n  const cellDate = cell.dayjs!.toDate()\n  cell.selected = _selectedDate.find(\n    (d) => d.valueOf() === cell.dayjs!.valueOf()\n  )\n  cell.isSelected = !!cell.selected\n  cell.isCurrent = isCurrent(cell)\n  cell.disabled = disabledDate?.(cellDate)\n  cell.customClass = cellClassName?.(cellDate)\n  return shouldIncrement\n}\n\nconst setRowMetadata = (row: DateCell[]) => {\n  if (props.selectionMode === 'week') {\n    const [start, end] = props.showWeekNumber ? [1, 7] : [0, 6]\n    const isActive = isWeekActive(row[start + 1])\n    row[start].inRange = isActive\n    row[start].start = isActive\n    row[end].inRange = isActive\n    row[end].end = isActive\n  }\n}\n\nconst rows = computed(() => {\n  const { minDate, maxDate, rangeState, showWeekNumber } = props\n\n  const offset = offsetDay.value\n  const rows_ = tableRows.value\n  const dateUnit = 'day'\n  let count = 1\n\n  if (showWeekNumber) {\n    for (let rowIndex = 0; rowIndex < 6; rowIndex++) {\n      if (!rows_[rowIndex][0]) {\n        rows_[rowIndex][0] = {\n          type: 'week',\n          text: startDate.value.add(rowIndex * 7 + 1, dateUnit).week(),\n        }\n      }\n    }\n  }\n\n  buildPickerTable({ row: 6, column: 7 }, rows_, {\n    startDate: minDate,\n    columnIndexOffset: showWeekNumber ? 1 : 0,\n    nextEndDate:\n      rangeState.endDate ||\n      maxDate ||\n      (rangeState.selecting && minDate) ||\n      null,\n    now: dayjs().locale(unref(lang)).startOf(dateUnit),\n    unit: dateUnit,\n    relativeDateGetter: (idx: number) =>\n      startDate.value.add(idx - offset, dateUnit),\n    setCellMetadata: (...args) => {\n      if (setCellMetadata(...args, count)) {\n        count += 1\n      }\n    },\n\n    setRowMetadata,\n  })\n\n  return rows_\n})\n\nwatch(\n  () => props.date,\n  async () => {\n    if (tbodyRef.value?.contains(document.activeElement)) {\n      await nextTick()\n      currentCellRef.value?.focus()\n    }\n  }\n)\n\nconst focus = async () => {\n  currentCellRef.value?.focus()\n}\n\nconst isNormalDay = (type = '') => {\n  return ['normal', 'today'].includes(type)\n}\n\nconst isCurrent = (cell: DateCell): boolean => {\n  return (\n    props.selectionMode === 'date' &&\n    isNormalDay(cell.type) &&\n    cellMatchesDate(cell, props.parsedValue as Dayjs)\n  )\n}\n\nconst cellMatchesDate = (cell: DateCell, date: Dayjs) => {\n  if (!date) return false\n  return dayjs(date)\n    .locale(lang.value)\n    .isSame(props.date.date(Number(cell.text)), 'day')\n}\n\nconst getCellClasses = (cell: DateCell) => {\n  const classes: string[] = []\n  if (isNormalDay(cell.type) && !cell.disabled) {\n    classes.push('available')\n    if (cell.type === 'today') {\n      classes.push('today')\n    }\n  } else {\n    classes.push(cell.type!)\n  }\n\n  if (isCurrent(cell)) {\n    classes.push('current')\n  }\n\n  if (\n    cell.inRange &&\n    (isNormalDay(cell.type) || props.selectionMode === 'week')\n  ) {\n    classes.push('in-range')\n\n    if (cell.start) {\n      classes.push('start-date')\n    }\n\n    if (cell.end) {\n      classes.push('end-date')\n    }\n  }\n\n  if (cell.disabled) {\n    classes.push('disabled')\n  }\n\n  if (cell.selected) {\n    classes.push('selected')\n  }\n\n  if (cell.customClass) {\n    classes.push(cell.customClass)\n  }\n\n  return classes.join(' ')\n}\n\nconst getDateOfCell = (row: number, column: number) => {\n  const offsetFromStart =\n    row * 7 + (column - (props.showWeekNumber ? 1 : 0)) - offsetDay.value\n  return startDate.value.add(offsetFromStart, 'day')\n}\n\nconst handleMouseMove = (event: MouseEvent) => {\n  if (!props.rangeState.selecting) return\n\n  let target = event.target as HTMLElement\n  if (target.tagName === 'SPAN') {\n    target = target.parentNode?.parentNode as HTMLElement\n  }\n  if (target.tagName === 'DIV') {\n    target = target.parentNode as HTMLElement\n  }\n  if (target.tagName !== 'TD') return\n\n  const row = (target.parentNode as HTMLTableRowElement).rowIndex - 1\n  const column = (target as HTMLTableCellElement).cellIndex\n\n  // can not select disabled date\n  if (rows.value[row][column].disabled) return\n\n  // only update rangeState when mouse moves to a new cell\n  // this avoids frequent Date object creation and improves performance\n  if (row !== lastRow.value || column !== lastColumn.value) {\n    lastRow.value = row\n    lastColumn.value = column\n    emit('changerange', {\n      selecting: true,\n      endDate: getDateOfCell(row, column),\n    })\n  }\n}\n\nconst isSelectedCell = (cell: DateCell) => {\n  return (\n    (!hasCurrent.value && cell?.text === 1 && cell.type === 'normal') ||\n    cell.isCurrent\n  )\n}\n\nconst handleFocus = (event: FocusEvent) => {\n  if (focusWithClick || hasCurrent.value || props.selectionMode !== 'date')\n    return\n  handlePickDate(event, true)\n}\n\nconst handleMouseDown = (event: MouseEvent) => {\n  const target = (event.target as HTMLElement).closest('td')\n  if (!target) return\n  focusWithClick = true\n}\n\nconst handleMouseUp = (event: MouseEvent) => {\n  const target = (event.target as HTMLElement).closest('td')\n  if (!target) return\n  focusWithClick = false\n}\n\nconst handlePickDate = (\n  event: FocusEvent | MouseEvent,\n  isKeyboardMovement = false\n) => {\n  const target = (event.target as HTMLElement).closest('td')\n\n  if (!target) return\n\n  const row = (target.parentNode as HTMLTableRowElement).rowIndex - 1\n  const column = (target as HTMLTableCellElement).cellIndex\n  const cell = rows.value[row][column]\n\n  if (cell.disabled || cell.type === 'week') return\n\n  const newDate = getDateOfCell(row, column)\n\n  if (props.selectionMode === 'range') {\n    if (!props.rangeState.selecting || !props.minDate) {\n      emit('pick', { minDate: newDate, maxDate: null })\n      emit('select', true)\n    } else {\n      if (newDate >= props.minDate) {\n        emit('pick', { minDate: props.minDate, maxDate: newDate })\n      } else {\n        emit('pick', { minDate: newDate, maxDate: props.minDate })\n      }\n      emit('select', false)\n    }\n  } else if (props.selectionMode === 'date') {\n    emit('pick', newDate, isKeyboardMovement)\n  } else if (props.selectionMode === 'week') {\n    const weekNumber = newDate.week()\n    const value = `${newDate.year()}w${weekNumber}`\n    emit('pick', {\n      year: newDate.year(),\n      week: weekNumber,\n      value,\n      date: newDate.startOf('week'),\n    })\n  } else if (props.selectionMode === 'dates') {\n    const newValue = cell.selected\n      ? castArray(props.parsedValue).filter(\n          (d) => d?.valueOf() !== newDate.valueOf()\n        )\n      : castArray(props.parsedValue).concat([newDate])\n    emit('pick', newValue)\n  }\n}\n\nconst isWeekActive = (cell: DateCell) => {\n  if (props.selectionMode !== 'week') return false\n  let newDate = props.date.startOf('day')\n\n  if (cell.type === 'prev-month') {\n    newDate = newDate.subtract(1, 'month')\n  }\n\n  if (cell.type === 'next-month') {\n    newDate = newDate.add(1, 'month')\n  }\n\n  newDate = newDate.date(Number.parseInt(cell.text as any, 10))\n\n  if (props.parsedValue && !Array.isArray(props.parsedValue)) {\n    const dayOffset = ((props.parsedValue.day() - firstDayOfWeek + 7) % 7) - 1\n    const weekDate = props.parsedValue.subtract(dayOffset, 'day')\n    return weekDate.isSame(newDate, 'day')\n  }\n  return false\n}\n\ndefineExpose({\n  /**\n   * @description focus on current cell\n   */\n  focus,\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}