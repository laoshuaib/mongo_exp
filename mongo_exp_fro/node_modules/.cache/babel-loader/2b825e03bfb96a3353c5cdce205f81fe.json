{"ast":null,"code":"import { ref, reactive, h, Transition, withCtx, withDirectives, createVNode, vShow, createApp, toRefs } from 'vue';\nimport '../../../hooks/index.mjs';\nimport '../../../utils/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { removeClass } from '../../../utils/dom/style.mjs';\n\nfunction createLoadingComponent(options) {\n  let afterLeaveTimer;\n  const ns = useNamespace(\"loading\");\n  const afterLeaveFlag = ref(false);\n  const data = reactive({ ...options,\n    originalPosition: \"\",\n    originalOverflow: \"\",\n    visible: false\n  });\n\n  function setText(text) {\n    data.text = text;\n  }\n\n  function destroySelf() {\n    const target = data.parent;\n\n    if (!target.vLoadingAddClassList) {\n      let loadingNumber = target.getAttribute(\"loading-number\");\n      loadingNumber = Number.parseInt(loadingNumber) - 1;\n\n      if (!loadingNumber) {\n        removeClass(target, ns.bm(\"parent\", \"relative\"));\n        target.removeAttribute(\"loading-number\");\n      } else {\n        target.setAttribute(\"loading-number\", loadingNumber.toString());\n      }\n\n      removeClass(target, ns.bm(\"parent\", \"hidden\"));\n    }\n\n    removeElLoadingChild();\n    loadingInstance.unmount();\n  }\n\n  function removeElLoadingChild() {\n    var _a, _b;\n\n    (_b = (_a = vm.$el) == null ? void 0 : _a.parentNode) == null ? void 0 : _b.removeChild(vm.$el);\n  }\n\n  function close() {\n    var _a;\n\n    if (options.beforeClose && !options.beforeClose()) return;\n    const target = data.parent;\n    target.vLoadingAddClassList = void 0;\n    afterLeaveFlag.value = true;\n    clearTimeout(afterLeaveTimer);\n    afterLeaveTimer = window.setTimeout(() => {\n      if (afterLeaveFlag.value) {\n        afterLeaveFlag.value = false;\n        destroySelf();\n      }\n    }, 400);\n    data.visible = false;\n    (_a = options.closed) == null ? void 0 : _a.call(options);\n  }\n\n  function handleAfterLeave() {\n    if (!afterLeaveFlag.value) return;\n    afterLeaveFlag.value = false;\n    destroySelf();\n  }\n\n  const elLoadingComponent = {\n    name: \"ElLoading\",\n\n    setup() {\n      return () => {\n        const svg = data.spinner || data.svg;\n        const spinner = h(\"svg\", {\n          class: \"circular\",\n          viewBox: data.svgViewBox ? data.svgViewBox : \"25 25 50 50\",\n          ...(svg ? {\n            innerHTML: svg\n          } : {})\n        }, [h(\"circle\", {\n          class: \"path\",\n          cx: \"50\",\n          cy: \"50\",\n          r: \"20\",\n          fill: \"none\"\n        })]);\n        const spinnerText = data.text ? h(\"p\", {\n          class: ns.b(\"text\")\n        }, [data.text]) : void 0;\n        return h(Transition, {\n          name: ns.b(\"fade\"),\n          onAfterLeave: handleAfterLeave\n        }, {\n          default: withCtx(() => [withDirectives(createVNode(\"div\", {\n            style: {\n              backgroundColor: data.background || \"\"\n            },\n            class: [ns.b(\"mask\"), data.customClass, data.fullscreen ? \"is-fullscreen\" : \"\"]\n          }, [h(\"div\", {\n            class: ns.b(\"spinner\")\n          }, [spinner, spinnerText])]), [[vShow, data.visible]])])\n        });\n      };\n    }\n\n  };\n  const loadingInstance = createApp(elLoadingComponent);\n  const vm = loadingInstance.mount(document.createElement(\"div\"));\n  return { ...toRefs(data),\n    setText,\n    removeElLoadingChild,\n    close,\n    handleAfterLeave,\n    vm,\n\n    get $el() {\n      return vm.$el;\n    }\n\n  };\n}\n\nexport { createLoadingComponent };","map":{"version":3,"mappings":"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","names":["createLoadingComponent","options","afterLeaveTimer","ns","useNamespace","afterLeaveFlag","ref","data","reactive","originalPosition","originalOverflow","visible","setText","text","destroySelf","target","parent","vLoadingAddClassList","loadingNumber","getAttribute","Number","parseInt","removeClass","bm","removeAttribute","setAttribute","toString","removeElLoadingChild","loadingInstance","unmount","_a","_b","vm","$el","parentNode","removeChild","close","beforeClose","value","clearTimeout","window","setTimeout","closed","call","handleAfterLeave","elLoadingComponent","name","setup","svg","spinner","h","class","viewBox","svgViewBox","innerHTML","cx","cy","r","fill","spinnerText","b","Transition","onAfterLeave","default","withCtx","withDirectives","createVNode","style","backgroundColor","background","customClass","fullscreen","vShow","createApp","mount","document","createElement","toRefs"],"sources":["../../../../../../packages/components/loading/src/loading.ts"],"sourcesContent":["import {\n  Transition,\n  createApp,\n  createVNode,\n  h,\n  reactive,\n  ref,\n  toRefs,\n  vShow,\n  withCtx,\n  withDirectives,\n} from 'vue'\nimport { useNamespace } from '@element-plus/hooks'\nimport { removeClass } from '@element-plus/utils'\n\nimport type { LoadingOptionsResolved } from './types'\n\nexport function createLoadingComponent(options: LoadingOptionsResolved) {\n  let afterLeaveTimer: number\n\n  const ns = useNamespace('loading')\n  const afterLeaveFlag = ref(false)\n  const data = reactive({\n    ...options,\n    originalPosition: '',\n    originalOverflow: '',\n    visible: false,\n  })\n\n  function setText(text: string) {\n    data.text = text\n  }\n\n  function destroySelf() {\n    const target = data.parent\n    if (!target.vLoadingAddClassList) {\n      let loadingNumber: number | string | null =\n        target.getAttribute('loading-number')\n      loadingNumber = Number.parseInt(loadingNumber as any) - 1\n      if (!loadingNumber) {\n        removeClass(target, ns.bm('parent', 'relative'))\n        target.removeAttribute('loading-number')\n      } else {\n        target.setAttribute('loading-number', loadingNumber.toString())\n      }\n      removeClass(target, ns.bm('parent', 'hidden'))\n    }\n    removeElLoadingChild()\n    loadingInstance.unmount()\n  }\n  function removeElLoadingChild(): void {\n    vm.$el?.parentNode?.removeChild(vm.$el)\n  }\n  function close() {\n    if (options.beforeClose && !options.beforeClose()) return\n\n    const target = data.parent\n    target.vLoadingAddClassList = undefined\n    afterLeaveFlag.value = true\n    clearTimeout(afterLeaveTimer)\n\n    afterLeaveTimer = window.setTimeout(() => {\n      if (afterLeaveFlag.value) {\n        afterLeaveFlag.value = false\n        destroySelf()\n      }\n    }, 400)\n    data.visible = false\n\n    options.closed?.()\n  }\n\n  function handleAfterLeave() {\n    if (!afterLeaveFlag.value) return\n    afterLeaveFlag.value = false\n    destroySelf()\n  }\n\n  const elLoadingComponent = {\n    name: 'ElLoading',\n    setup() {\n      return () => {\n        const svg = data.spinner || data.svg\n        const spinner = h(\n          'svg',\n          {\n            class: 'circular',\n            viewBox: data.svgViewBox ? data.svgViewBox : '25 25 50 50',\n            ...(svg ? { innerHTML: svg } : {}),\n          },\n          [\n            h('circle', {\n              class: 'path',\n              cx: '50',\n              cy: '50',\n              r: '20',\n              fill: 'none',\n            }),\n          ]\n        )\n\n        const spinnerText = data.text\n          ? h('p', { class: ns.b('text') }, [data.text])\n          : undefined\n\n        return h(\n          Transition,\n          {\n            name: ns.b('fade'),\n            onAfterLeave: handleAfterLeave,\n          },\n          {\n            default: withCtx(() => [\n              withDirectives(\n                createVNode(\n                  'div',\n                  {\n                    style: {\n                      backgroundColor: data.background || '',\n                    },\n                    class: [\n                      ns.b('mask'),\n                      data.customClass,\n                      data.fullscreen ? 'is-fullscreen' : '',\n                    ],\n                  },\n                  [\n                    h(\n                      'div',\n                      {\n                        class: ns.b('spinner'),\n                      },\n                      [spinner, spinnerText]\n                    ),\n                  ]\n                ),\n                [[vShow, data.visible]]\n              ),\n            ]),\n          }\n        )\n      }\n    },\n  }\n\n  const loadingInstance = createApp(elLoadingComponent)\n  const vm = loadingInstance.mount(document.createElement('div'))\n\n  return {\n    ...toRefs(data),\n    setText,\n    removeElLoadingChild,\n    close,\n    handleAfterLeave,\n    vm,\n    get $el(): HTMLElement {\n      return vm.$el\n    },\n  }\n}\n\nexport type LoadingInstance = ReturnType<typeof createLoadingComponent>\n"]},"metadata":{},"sourceType":"module"}